# APEX: AI 网球性能提升应用 MVP PRD

## 1. 逻辑思维 (Logical Thinking): 项目概述与目标

| 字段 | 描述 | 引用支持 |
| :--- | :--- | :--- |
| **应用名称** | APEX | |
| **核心问题** | 业余网球爱好者难以找到或负担得起专业教练来提升网球表现。 | |
| **核心目标** | 开发一款 iOS 原生 AI 应用，提供精确的生物力学和性能反馈，以提升用户的网球技术（初始聚焦于发球分析）。 | |
| **目标用户** | 寻求专业、数据驱动型指导、希望降低教练成本的业余网球运动员。 | |
| **开发模式** | **Vibe Coding (氛围编程)**：高度依赖大型语言模型（LLM）Agent 来生成和管理代码,。 | |
| **MVP 范围** | **发球分析（Serve Analysis）**：专注姿势识别、生物力学指标提取和自然语言反馈。 | |

---

## 2. 分析思维 (Analytical Thinking): 技术栈与框架要求

本部分定义了实现网球运动分析所需的关键技术和核心设计理念，以指导 LLM 采用最高效、最准确的解决方案。

| 领域 | 解决方案/算法 | 关键要求与优势 | 引用支持 |
| :--- | :--- | :--- | :--- |
| **开发环境** | AI 代码编辑器（如 Cursor/Windsurf） | 必须在支持 **Agent 模式** 的环境中执行，允许 AI 创建、修改文件和运行命令，以完成复杂项目构建,,。 |
| **目标平台** | iOS 原生 (Swift/SwiftUI) | 必须利用 **CoreML/Neural Engine (ANE)** 进行模型推理，以确保高能效和低延迟,。 |
| **人体姿势估计** | **MediaPipe Pose (BlazePose)** | 优选 33 关键点模型。必须输出 **3D 世界坐标地标 (World Landmarks)**，以解决移动设备录制视频中的透视失真问题，实现准确的击球形态矫正。 |
| **动作识别与分类** | **空间-时间图卷积网络 (ST-GCN)** | 专门用于分析骨骼数据（将关节视为图结构），以捕获复杂的时序运动特征和分类击球类型。 |
| **高速球体追踪** | **TrackNet (V2/V4)** | 采用 **多帧输入多帧输出 (MIMO)** 架构和**概率热图**输出，增强对高速移动和运动模糊的鲁棒性。V4 版本应集成 **运动注意力图** 以减少背景干扰,,。 |
| **轨迹预测与平滑** | **Kalman 滤波器** | 必须结合视觉模型使用，用于在球被遮挡（Occlusion）时，根据物理模型持续预测和保持轨迹连续性,。 |
| **用户反馈系统** | **神经-符号式 (Neuro-Symbolic) 框架** | 将结构化指标（如角度偏差）与**精英参考范围**进行对比，并使用 LLM（例如，参考 “Talking Tennis”框架）生成自然语言的、可操作的指导,。 |

---

## 3. 计算思维 (Computational Thinking): 里程碑与关键指标

本阶段定义分阶段实现的功能，并明确可量化、可验证的核心技术和业务指标。

### 里程碑 1：发球基础分析 (MVP)

**输入要求：** 用户录制的发球视频（要求清晰可见全身和球）。

| 功能模块 | 关键活动与技术约束 | 核心输出指标（Serve） |
| :--- | :--- | :--- |
| **数据预处理** | 必须采用 **One Euro Filter** 对原始关键点数据进行平滑处理，以消除视觉噪声和抖动。 | 姿势关键点 (33个), 运动轨迹平滑度。 |
| **现实世界映射（校准）** | 必须要求用户输入**身高**或使用**球场已知尺寸**（例如，底线长度）作为像素到米 (Pixels-to-Meters) 的转换基准，以实现物理速度和距离的计算。 | **击球速度 (km/h)**, **接触高度 (m)**。 |
| **击球形态分析** | 姿势模型应识别关键发力阶段：屈膝蓄力、躯干旋转和击球瞬间。 | **髋肩分离度 (Hip-Shoulder Separation)**, **膝关节屈曲度 (Knee Flexion)**。 |
| **发球质量评估** | 计算拍头速度（应结合拖拽/阻力模型进行修正）。 | **拍头速度 (Racket Head Velocity)**，发力序列的计时（Kinetic Chain Timing）,。 |
| **自动反馈** | 基于精英数据模型生成个性化、口语化的纠正建议。 | **纠正反馈语句**（例如：“你的膝盖弯曲不足，请尝试更深的下蹲”）。 |

### 里程碑 2：性能监控与数据管理 (v2.0 - ✅ 完成)

| 功能模块 | 关键活动与技术约束 | 核心输出指标 | 状态 |
| :--- | :--- | :--- | :--- |
| **发球阶段检测** | 自动识别准备/蓄力/接触/随挥 4 个阶段，记录每阶段时间戳和关键指标。 | 4-阶段事件序列，每阶段的生物力学参数。 | ✅ v2.0 |
| **AI 反馈生成** | 基于生物力学指标与精英标准的对比，生成自然语言反馈，包括严重程度分类。 | **反馈项目** (Severity: High/Medium/Low, Category, Actionable Tips)。 | ✅ v2.0 |
| **数据持久化** | 使用 **SwiftData** 存储分析会话，包括姿势帧序列、生物力学指标、反馈项目和用户评分。 | 分析会话数据库，支持 CRUD 和 JSON 导出。 | ✅ v2.0 |
| **性能监控仪表板** | 实时监控处理帧率 (FPS)、推理延迟、内存使用和电池消耗。 | **FPS 曲线图**, **推理时间分布**, **优化建议**。 | ✅ v2.0 |

### 里程碑 3：增强型 UI 与用户体验 (v3.0 - ✅ 完成)

| 功能模块 | 关键活动与技术约束 | 核心输出指标 | 状态 |
| :--- | :--- | :--- | :--- |
| **会话历史浏览** | 实现可排序、可筛选的会话列表视图，支持按日期、质量分数、时长等维度。支持滑动删除/导出。 | **SessionHistoryView** (520 行代码)，支持 4 种排序和 3 种筛选选项。 | ✅ v3.0 |
| **反馈卡片展示** | 设计可展开的反馈卡片，显示严重程度、类别、可操作建议和影响分析。支持按类别筛选。 | **FeedbackCardView** (290 行代码)，**FeedbackBatchView** 支持批量显示和分类筛选。 | ✅ v3.0 |
| **发球阶段可视化** | 实现 4 阶段进度条、时间轴展示、紧凑型徽章和浮动指示器，支持实时动画。 | **PhaseIndicatorView** (370 行代码)，包含 **PhaseBadgeView** 和 **MiniPhaseIndicatorView**。 | ✅ v3.0 |
| **用户界面集成** | 在发球分析界面中整合历史、反馈、阶段三个新组件，通过 Sheet 模态展示详情。 | 历史/反馈按钮集成，状态管理与响应式更新。 | ✅ v3.0 |

### 里程碑 4：核心击球和球轨迹追踪 (v4.0 - 规划中)

| 功能模块 | 关键活动与技术约束 | 核心输出指标 |
| :--- | :--- | :--- |
| **视频录制与回放** | 支持会话视频录制、保存关联、慢动作分析 (120fps)、逐帧导航。 | **AVCaptureMovieFileOutput** 集成，视频播放和帧导航功能。 |
| **击球扩展** | 扩展姿势识别和生物力学分析至正手 (Forehand)、反手 (Backhand) 和截击 (Volley)。 | 多击球类型的生物力学参数，对比分析功能。 |
| **球轨迹追踪** | 实施 **TrackNet** 模型并集成 **Kalman 滤波器**。处理**运动模糊**和**遮挡**情况。 | 3D 轨迹重构 ($x, y, z$)，高速球体追踪。 |
| **高级性能分析** | 速度计算考虑空气阻力。利用姿势数据推断球的旋转。实现统计仪表板。 | **落点精度** (Spot Accuracy), **球速衰减率**, **旋转类型** (上旋/侧旋)。 |

---

## 4. 程序思维 (Procedural Thinking): 实施标准与保障

本部分规定了项目实施、代码质量和性能优化所需的工程实践。

| 领域 | 标准与要求 | 引用支持 |
| :--- | :--- | :--- |
| **版本控制** | **必须使用 Git/GitHub**。LLM 必须在添加主要功能或进行重大修改前执行 `git commit` 操作，以创建可回溯的检查点，避免工作丢失,。 |
| **性能和效率** | 视频处理帧率必须达到 **60 FPS 或更高**。必须优化模型（例如，使用 **Float16 Quantization**）以在不影响精度的前提下减轻移动设备的热管理和电池负担,。 |
| **调试与测试** | LLM 必须能够系统性地处理错误。在收到错误信息或异常行为的**截图**和**错误日志**时，应优先尝试自我修正，并应用调试技巧（例如，检查 `console.log` 输出）,。 |
| **数据一致性** | 姿势和球体坐标必须统一使用**归一化坐标系统**进行内部计算，仅在输出物理指标时进行校准转换。 |
| **用户体验（反馈风格）** | LLM 生成的教练反馈必须是**鼓励性的、简洁的（< 50字）**，并直接指出问题和相应的训练重点，避免冰冷的数据报告风格。 |
| **模型可解释性** | 所有指标分析应明确链接到具体的生物力学原理（例如，低接触高度如何影响过网裕度）和精英数据标准。 | |